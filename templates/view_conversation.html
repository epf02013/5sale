<!DOCTYPE html>
<html>
<head>
    <title>CS133 Awesome Project</title>





{%from 'macros.html' import header as header%}

{{header()}}


</head>
<body>
<div class="navbar clear">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse" id="menu" style=" height:30px;padding:0px;width: 40px!important; background-color: white">
        <span class="iconn-bar the-top top-bottom"></span>
          <span class="iconn-bar top"></span>
          <span class="iconn-bar bottom"></span>
          <span class="iconn-bar the-bottom top-bottom"></span>
      </button>
      <a class="navbar-brand" href="/">5Sale</a>
    </div>
    <div class="navbar-collapse collapse navbar-responsive-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/home"><span>Browse</span></a></li>
        <li><a href="/my_items">My Items</a></li> 
        <li><a href="/post_item">Post Item</a></li>
        <li class="active"><a href="/view_conversations"> <i class="material-icons">message</i></a></li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Notifications
          <span class="caret"></span></a>
          <ul class="dropdown-menu">
            {%for notification in notifications%}
              <li><a href="/notifications/{{notification.key.id()}}">{{notification.body}}</a></li>
            {%endfor%}
          </ul>
        </li> 
      </ul>
    </div>
  </div>
</div>
<div class="nav-spacer"></div>

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-1"></div>
    <div class="col-xs-10" align="left">
      <div class="conversation-box">
        {%if session.user_id==conversation.user1%}
          <div class="name sale">Sale of {{conversation.item_name}}</div>
        {%else%}
          <div class="name purchase">Purchase of {{conversation.item_name}}</div>
        {%endif%}
        <div class="messages">
          {%for message in messages%}
            {%if session.user_id==message.sender%}
              <div align="right">
               <div class="message sent">
                 {{message.body}}
               </div>
              </div>
            {%else%}
              <div align="left">
               <div class="message received">
                 {{message.body}}
               </div>
              </div>
            {%endif%}
          {%endfor%}
        </div>
        <textarea class="type-message" id="type_message"></textarea>
        <button class="btn btn-info" onclick="send_message();">Send Messsage</button>
      </div>
    </div>
    <div class="col-xs-1"></div>
    
  </div>
  
</div>


{%from 'macros.html' import scripts as scripts%}

{{scripts()}}

</body>

<script type="text/javascript">
  function send_message() {
    $.post("/messages",
            {conversation:"{{conversation.key.id()}}",message_body:$("#type_message").val()},
            function(data, status){
              $(".messages").append("<div align='right'><div class='message sent'>"+$("#type_message").val()+"</div></div>");
              $("#type_message").val("");
              
    });
  }
</script>
    
</html>